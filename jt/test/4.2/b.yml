- name: backup
  hosts: ios,junos
  gather_facts: no

  tasks:
    - name: backup
      vars:
        ansible_connection: ansible.netcommon.network_cli
      ansible.netcommon.cli_config:
        backup: True
        backup_options:
          dir_path: /tmp
          filename: "{{ inventory_hostname }}.cfg"   

    - name: create backup dir
      ansible.builtin.file:
        path: /tmp/backup
        state: directory
      run_once: yes
      delegate_to: workstation.lab.example.com

    - name: save backups 
      ansible.builtin.copy:
        src: "/tmp/{{ inventory_hostname }}.cfg"
        dest: "/tmp/backup/{{ inventory_hostname }}.cfg"
      delegate_to: workstation.lab.example.com


